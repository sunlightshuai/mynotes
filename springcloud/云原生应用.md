# 云原生应用
[springcloud的官方文档](http://cloud.spring.io/spring-cloud-static/Greenwich.SR1/single/spring-cloud.html#_cloud_native_applications)第一部分是云原生，而云原生的解释是一种应用程序的开发风格。那么这种风格是怎么体现的。文档中也给出了两个方面的解释。
1，spring Cloud Context
2，spring Cloud Commons

## Spring Cloud Context应用上下文服务
应用上下文，通过springBoot来构建
```java

		AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext();
		context.registerBean("helloworld",String.class, "helloworld");
		context.setId("sunli");
		context.refresh();
		new SpringApplicationBuilder(SpringCloudDemoApplication.class)
		.parent(context).run(args);

```

注意：在pom文件中请查阅springCloud官方文档中，给出的springCloud的版本和springBoot版本。

### Bootstrap应用程序上下文
Spring Cloud应用程序通过创建“ 引导程序 ”上下文来运行，该上下文是主应用程序的父上下文。它负责从外部源加载配置属性以及解密本地外部配置文件中的属性。这两个上下文共享一个Environment，它是任何Spring应用程序的外部属性的来源。引导上下文使用不同的约定来定位外部配置而不是主应用程序上下文。
`Environment` 有两种实现方式：
普通类型：`StandardEnvironment`
Web类型：`StandardServletEnvironment`
### 应用上下文层次结构
如果从SpringApplication或构建应用程序上下文SpringApplicationBuilder，可参考	`SpringApplicationBuilder` 源码(parent()，child()和sibling())。将Bootstrap上下文添加为该上下文的父级。Spring的一个特性是子上下文从其父级继承属性源和配置文件。普通的Spring应用程序上下文行为规则适用于属性解析：来自子上下文的属性按名称和属性源名称覆盖父级中的属性。

```java

	public ConfigurableApplicationContext run(String... args) {
		if (this.running.get()) {
			// If already created we just return the existing context
			return this.context;
		}
		configureAsChildIfNecessary(args);
		if (this.running.compareAndSet(false, true)) {
			synchronized (this.running) {
				// If not already running copy the sources over and then run.
				this.context = build().run(args);
			}
		}
		return this.context;
	}

	private void configureAsChildIfNecessary(String... args) {
		if (this.parent != null && !this.configuredAsChild) {
			this.configuredAsChild = true;
			if (!this.registerShutdownHookApplied) {
				this.application.setRegisterShutdownHook(false);
			}
			initializers(new ParentContextApplicationContextInitializer(
					this.parent.run(args)));
		}
	}
```
可查看`ApplicationContextInitializer`用于设置父上下文。 当刷新上下文以向其他侦听器发信号通知上下文可用，还发布`ParentContextApplicationContextInitializer.ParentContextAvailableEvent`。

#### 事件/监听模式

`java.util.EventObject` ：事件对象

​	* 事件对象总是关联着事件源（source）

`java.util.EventListener` ：事件监听接口（标记）

##### Spring 事件/监听

`ApplicationEvent` : 应用事件

`ApplicationListener` : 应用监听器

##### Spring Boot 事件/监听器

###### ConfigFileApplicationListener

管理配置文件，比如：`application.properties` 以及 `application.yaml`

`application-{profile}.properties`:

profile  = dev 、test

1. `application-{profile}.properties`
2. application.properties

## Spring Cloud Commons 常见抽象
主要有服务发现，负载平衡和断路器等模式等。